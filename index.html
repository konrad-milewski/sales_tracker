<!DOCTYPE html>
<html>
<head>
    <title>My Sales Tracker</title>
    <style>
@media print {
    body * {
        visibility: hidden;
    }

#filters, {
visibility: visible;
}

h3{
visibility: visible;
}
    #salesTable, #salesTable * {
        visibility: visible;
    }
    #salesTable {
        
    }
}
        
         body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 0;
  }

  a {
    color: #039be5;
    text-decoration: none;
  }

  a:hover {
    color: #0288d1;
  }

  button {
    background-color: #039be5;
    border: none;
    border-radius: 4px;
    color: white;
    cursor: pointer;
    font-size: 14px;
    padding: 12px 24px;
    text-transform: uppercase;
  }

  button:hover {
    background-color: #0288d1;
  }

  h1, h3 {
    margin: 0;
  }

  h1 {
    font-size: 24px;
    font-weight: normal;
    margin-bottom: 16px;
  }

  h3 {
    font-size: 18px;
    font-weight: normal;
    margin-bottom: 8px;
    margin-top: 24px;
  }

  input[type="date"],
  input[type="text"] {
    border-bottom: 1px solid #9e9e9e;
    border-top: none;
    border-left: none;
    border-right: none;
    box-sizing:border-box; 
    font-size:16px; 
    margin-bottom:8px; 
    outline:none; 
    padding-bottom:7px; 
    width:100%;
}

input[type="date"]:focus,
input[type="text"]:focus {
border-bottom-color:#039be5; 
}

input[type="submit"] {
background-color:#039be5; 
border:none; 
border-radius:4px; 
color:white; 
cursor:pointer; 
font-size:14px; 
padding:12px 24px; 
text-transform:uppercase; 
}

input[type="submit"]:hover {
background-color:#0288d1; 
}

table {
border-collapse:collapse; 
width:100%; 
}

table th,
table td {
border-bottom:solid thin #ddd; 
padding-bottom:.5em; 
padding-top:.5em; 
text-align:left; 
}

table th {
color:#9e9e9e; 
font-size:.85em; 
font-weight:normal; 
letter-spacing:.06em; 
text-transform:uppercase; 
}

ul li span {
color:#039be5; 
}
</style>
        
      
       
    </style>
</head>
<body>
<a href="./index.html"/>Sales Tracker</a>
<a href="./dataanalyzer.html"/>Data analyzer</a>
<a href="./jsonviewer.html"/>Json Viewer</a>
<a href="./statistics.html"/>Statistics</a>

<button onclick="printTable()">Print Table</button>

    <h1>My Sales Tracker</h1>

    <h3>Date Filter:</h3>

    <div id="filters">Start Date: <input type="date" id="startDate"><br><br>
    End Date: <input type="date" id="endDate"><br><br>
    <button onclick="updateTable()">Apply Filter</button><br><br></div>

    <table id="salesTable">
        <tr>
            <th>Item</th>
            <th>Cost (zł)</th>
            <th>Price (zł)</th>
            <th>Date Sold</th>
        </tr>
    </table>

    <h3>Add a Sale:</h3>
    <form id="addSaleForm">
        Item: <input type="text" id="itemInput"><br><br>
        Cost: <input type="text" id="costInput"><br><br>
        Price: <input type="text" id="priceInput"><br><br>
        Date Sold: <input type="date" id="dateInput"><br><br>
        <input type="submit" value="Submit">
    </form>

<div id="totalProfitContainer">
    <h3>Total Profit:</h3>
    <p id="totalProfit"></p>
</div>

<h3>Sales Chart:</h3>
<canvas id="salesChart"></canvas>

<h3>Statistics:</h3>
<ul>
    <li>Total Sales: <span id="totalSales"></span></li>
    <li>Average Sale Price: <span id="averageSalePrice"></span></li>
    <li>Highest Sale Price: <span id="highestSalePrice"></span></li>
    <li>Lowest Sale Price: <span id="lowestSalePrice"></span></li>
</ul>

    <h3>Import/Export:</h3>
    <button onclick="exportData()">Export Data</button><br><br>
    <textarea id="importData"></textarea><br><br>
    <button onclick="importData()">Import Data</button>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        var sales = JSON.parse(localStorage.getItem("sales")) || [];

        function updateTable() {
            var startDate = document.getElementById("startDate").value;
            var endDate = document.getElementById("endDate").value;

            var table = document.getElementById("salesTable");
            var rowCount = table.rows.length;
            for (var i = rowCount - 1; i > 0; i--) {
                table.deleteRow(i);
            }

            var totalEarnings = 0;
            var totalCost = 0;
            for (var i = 0; i < sales.length; i++) {
                if ((!startDate || sales[i].date >= startDate) && (!endDate || sales[i].date <= endDate)) {
                    var row = table.insertRow(-1);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    var cell4 = row.insertCell(3);
                    cell1.innerHTML = sales[i].item;
                    cell2.innerHTML = sales[i].cost;
                    cell3.innerHTML = sales[i].price;
                    cell4.innerHTML = sales[i].date;

                    totalEarnings += parseFloat(sales[i].price);
                    totalCost += parseFloat(sales[i].cost);
                }
            }

            var totalProfit = totalEarnings - totalCost;
            document.getElementById("totalProfit").innerHTML = totalProfit.toFixed(2);
        }

        updateTable();

        document.getElementById("addSaleForm").onsubmit = function(event) {
            event.preventDefault();
            var item = document.getElementById("itemInput").value;
            var cost = document.getElementById("costInput").value;
            var price = document.getElementById("priceInput").value;
            var date = document.getElementById("dateInput").value;

            sales.push({item: item, cost: cost, price: price, date: date});
            localStorage.setItem("sales", JSON.stringify(sales));

            updateTable();

            document.getElementById("itemInput").value = "";
            document.getElementById("costInput").value = "";
          document.getElementById("priceInput").value = "";
            document.getElementById("dateInput").value = "";
        }

        function exportData() {
            var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(sales));
            var downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "sales.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function importData() {
            var data = JSON.parse(document.getElementById("importData").value);
            sales = data;
            localStorage.setItem("sales", JSON.stringify(sales));
            updateTable();
        }
function printTable() {
    var startDate = document.getElementById("startDate").value;
    var endDate = document.getElementById("endDate").value;

    var printContents = "<h3>Date Filter:</h3>";
    printContents += "Start Date: " + startDate + "<br>";
    printContents += "End Date: " + endDate + "<br><br>";
    printContents += document.getElementById("salesTable").outerHTML;
var totalProfit = document.getElementById("totalProfit").innerHTML;

    
    printContents += "<h3>Total Profit: </h3>" + totalProfit + "zł";



    var originalContents = document.body.innerHTML;

    document.body.innerHTML = printContents;
    window.print();
    document.body.innerHTML = originalContents;
}

function updateStatistics() {
    var totalSales = sales.length;
    document.getElementById("totalSales").innerHTML = totalSales;

    var totalSalePrice = 0;
    var highestSalePrice = 0;
    var lowestSalePrice = Infinity;
    for (var i = 0; i < sales.length; i++) {
        var salePrice = parseFloat(sales[i].price);
        totalSalePrice += salePrice;
        if (salePrice > highestSalePrice) {
            highestSalePrice = salePrice;
        }
        if (salePrice < lowestSalePrice) {
            lowestSalePrice = salePrice;
        }
    }

    var averageSalePrice = totalSales > 0 ? (totalSalePrice / totalSales).toFixed(2) : 0;
    document.getElementById("averageSalePrice").innerHTML = averageSalePrice;

    document.getElementById("highestSalePrice").innerHTML = highestSalePrice;
    document.getElementById("lowestSalePrice").innerHTML = lowestSalePrice == Infinity ? 0 : lowestSalePrice;
}

updateStatistics();
function updateChart() {
    var salesData = {};
    for (var i = 0; i < sales.length; i++) {
        var date = new Date(sales[i].date);
        var month = date.toLocaleString('default', { month: 'long' });
        if (salesData[month]) {
            salesData[month] += parseFloat(sales[i].price);
        } else {
            salesData[month] = parseFloat(sales[i].price);
        }
    }

    var ctx = document.getElementById('salesChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(salesData),
            datasets: [{
                label: 'Total Sales',
                data: Object.values(salesData),
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

updateChart();
function addToggleTableButton() {
    const tables = document.querySelectorAll('table');
    tables.forEach(table => {
        const button = document.createElement('button');
        button.textContent = 'Hide/Show Table';
        button.onclick = function() {
            if (table.style.display === 'none') {
                table.style.display = '';
            } else {
                table.style.display = 'none';
            }
        };
        table.parentNode.insertBefore(button, table);
    });
}

window.onload = function() {
    addToggleTableButton();
};
    </script>
</body>
</html>
